<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title }}</title>

    <!-- Plotly -->
    <script
      defer
      src="https://cdn.plot.ly/plotly-3.1.0-rc.0.min.js"
      charset="utf-8"
    ></script>

    <!-- Bootstrap + Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    ></script>

<style>
  html {
    scroll-behavior: smooth;
  }
  body {
    font-family: sans-serif;
    overflow-x: hidden;
  }

  /* feature links */
    .feature-select {
      position: fixed;
      top: 5px; 

      z-index: 999;
      padding: 5px 2em;

      font-size: 14px;
      font-weight: bold;
    }
    .feature-link {
      text-decoration: none;
    }

    .feature-link:hover {
      text-decoration: underline;
    }

  /* Tabs */
  .tab {
    display: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }
  .tab.active {
    display: block;
    opacity: 1;
  }

  .flex-grow-1 {
    min-width: 0;
    overflow-x: hidden;
  }

  /* Header */
  .header-title-group {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    width: 100%;
  }
  .report-date {
    margin: 0;
    font-size: 0.9em;
    margin-left: auto;
    padding-right: 80px;
  }

  /* Sidebar */
  .sidebar {
    position: sticky;
    top: 0;
    height: 100vh;
    overflow-y: auto;
    transition: width 0.3s ease;
  }
  .sidebar.collapsed {
    flex: 0 0 60px;
    width: 60px;
  }
  .sidebar.expanded {
    flex: 0 0 250px;
    width: 250px;
  }
  #toggleSidebar {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0.375rem;
    width: 40px;
    height: 40px;
  }

  .sidebar .nav-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.375rem 1rem;
    white-space: nowrap;
  }
  .sidebar .nav-link i {
    flex-shrink: 0;
    width: 20px;
    text-align: center;
    line-height: 1;
    font-size: 1.25rem;
  }

  /* Hide labels when collapsed */
  .menu-label {
    transition: opacity 0.3s, width 0.3s;
  }
  .sidebar.collapsed .menu-label {
    opacity: 0;
    width: 0;
    overflow: hidden;
  }

  .collapse-inner {
    padding-left: 1.5rem;
  }

  @media (max-width: 768px) {
    .sidebar {
      position: absolute;
      z-index: 1040;
    }
  }

  /* tables */

  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1em;
    
    /* --- Add this line --- */
    table-layout: fixed;   /* This is crucial for controlling column widths */
  }

  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
    overflow-wrap: anywhere; /* modern browsers */
    word-wrap: break-word;   /* legacy support */
    word-break: break-word;  /* another fallback */
    white-space: normal;     /* ensures text wrapping is allowed */

  }

  /* Keep first column a fixed width but still wrap */
  table td:first-child,
  table th:first-child {
    width: 200px;
    white-space: normal; /* changed from nowrap */
  }

.table-wrapper2 table {
    min-width: 90%;
    width: 100%; /* You can also add this to be explicit */
}

  .table-wrapper {
    overflow-x: auto;
    width: 100%;
    max-width: 100vw;      /* Limit to viewport width */
    background-color: var(--bs-table-striped-bg);
  }
  .table-wrapper table {
    width: max-content;
    min-width: 90%;
  }
  .table-wrapper th, .table-wrapper td {
    padding: 8px;
  }

  /* inner tab */
  .tabcontent-inner { display: none; padding: 10px 0; }
  .tab-inner button { 
    margin-right: 5px; 
    min-width: 120px;
    min-height: 20px;
    text-align: center;
    cursor: pointer;
  }
  
  .tabcontent-inner_test { display: none; padding: 10px 0; }
  .tab-inner_test button { 
    margin-right: 5px; 
    min-width: 120px;
    min-height: 20px;
    text-align: center;
    cursor: pointer;
  }

.feature-table-internal table {
  border-collapse: collapse;
  width: 100%;
  table-layout: auto;   /* let the browser size based on content */
}

.feature-table-internal th:nth-child(1),
.feature-table-internal td:nth-child(1),
.feature-table-internal th:nth-child(2),
.feature-table-internal td:nth-child(2) {
  white-space: nowrap;  /* keep text in one line */
  width: 1%;            /* hint: shrink as much as possible */
}

.feature-table-internal th:nth-child(3),
.feature-table-internal td:nth-child(3) {
  width: 100%;          /* take up remaining space */
}

</style>

  </head>

  <body>
    <div class="d-flex">
      <!-- Sidebar -->
      <nav
        id="sidebar"
        class="sidebar bg-body-tertiary expanded border-end"
        aria-label="Sidebar navigation"
      >
        <div class="d-flex flex-column p-3">
          <button
            id="toggleSidebar"
            class="btn btn-outline-secondary mb-3"
            aria-label="Toggle sidebar"
          >
            <i class="bi bi-list"></i>
          </button>

          <ul class="nav nav-pills flex-column mb-auto" id="menuAccordion">

            <!-- General overview -->
            <li class="nav-item">
              <button
                class="nav-link d-flex align-items-center"
                data-bs-toggle="collapse"
                data-bs-target="#menu1"
                aria-expanded="false"
                aria-controls="menu1"
              >
                <i class="bi bi-database"></i>
                <span class="menu-label">General overview</span>
              </button>
              <div class="collapse" id="menu1">
                <div class="collapse-inner">
                  <button class="nav-link"  data-tab="0.#Dataset-overview">
                    Dataset Overview
                  </button>
                  <button class="nav-link"  data-tab="0.#Sample-data-train-set">
                    Sample Data
                  </button>
                </div>
              </div>
            </li>

            <!-- Features -->
            <li class="nav-item">
              <button class="nav-link" data-tab="1">
                <i class="bi bi-ui-checks-grid"></i>
                <span class="menu-label">Features</span>
              </button>
            </li>
            <!-- Target Relations -->
            <li class="nav-item">
              <button
                class="nav-link d-flex align-items-center"
                data-bs-toggle="collapse"
                data-bs-target="#menu3"
                aria-expanded="false"
                aria-controls="menu3"
              >
            <i class="bi bi-graph-up"></i>
            <span class="menu-label">Target Relations</span>
          </button>
          <div class="collapse" id="menu3">
            <div class="collapse-inner">
              <button class="nav-link"  data-tab="2.#feature_importance">
                Feature Importance
              </button>
              <button class="nav-link"  data-tab="2.#feature_target">
                Feature/Target Relation
              </button>
            </li>
            <!-- Feature Relations -->
            <li class="nav-item">
              <button
                class="nav-link d-flex align-items-center"
                data-bs-toggle="collapse"
                data-bs-target="#menu4"
                aria-expanded="false"
                aria-controls="menu4"
              >
            <i class="bi bi-diagram-3"></i>
            <span class="menu-label">Feature Relations</span>
          </button>
          <div class="collapse" id="menu4">
            <div class="collapse-inner">
              <button class="nav-link"  data-tab="3.#numeric_heatmap">
                Numeric Heatmap
              </button>
              <button class="nav-link"  data-tab="3.#categorical_heatmap">
                Categorical Heatmap
              </button>
              <button class="nav-link"  data-tab="3.#pairwise_summary">
                Pairwise Summary
              </button>
              <button class="nav-link"  data-tab="3.#pairwise_plots">
                Pairwise Plots
              </button>
            </li>
            <!-- Missing data-->
            <li class="nav-item">
              <button
                class="nav-link d-flex align-items-center"
                data-bs-toggle="collapse"
                data-bs-target="#menu5"
                aria-expanded="false"
                aria-controls="menu5"
              >
            <i class="bi bi-body-text"></i>
            <span class="menu-label">Missing Data</span>
          </button>
          <div class="collapse" id="menu5">
            <div class="collapse-inner">
              <button class="nav-link"  data-tab="4.#missing_overview">
                Missing Data Overview
              </button>
              <button class="nav-link"  data-tab="4.#missing_feature">
                Missing Data per Feature
              </button>
            </li>
          </ul>

          <hr />
          <!-- Theme toggle -->
          <div class="d-flex justify-content-between align-items-center">
            <span class="menu-label">Theme</span>
            <div class="form-check form-switch mb-0">
              <input
                class="form-check-input"
                type="checkbox"
                id="themeToggle"
                aria-label="Toggle theme"
              />
            </div>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="flex-grow-1 p-4">
        <div class="header-title-group">
          <h1>{{ title }}</h1>
          <p class="report-date">
            Report generated on: {{ current_time.strftime("%Y-%m-%d %H:%M:%S") }}
          </p>
        </div>

        {% for tab in tabs %}
        <div
          class="tab {% if loop.index0 == 0 %}active{% endif %}"
          id="tab-{{ loop.index0 }}"
        >
          {{ tab.content | safe }}
        </div>
        {% endfor %}
      </main>
    </div>

    <!-- Custom JS -->
    <script>
      const sidebar = document.getElementById("sidebar");
      const toggleBtn = document.getElementById("toggleSidebar");
      const themeToggle = document.getElementById("themeToggle");
      const html = document.documentElement;
      const allMenus = Array.from(document.querySelectorAll(".collapse")).map(
        (el) => `#${el.id}`
      );

      /* ----------------- Sidebar toggle ----------------- */
      toggleBtn.addEventListener("click", () => {
        const wasExpanded = sidebar.classList.contains("expanded");
        sidebar.classList.toggle("collapsed", wasExpanded);
        sidebar.classList.toggle("expanded", !wasExpanded);
        localStorage.setItem("sidebar", wasExpanded ? "collapsed" : "expanded");

        if (wasExpanded) {
          allMenus.forEach((id) => {
            const el = document.querySelector(id);
            bootstrap.Collapse.getOrCreateInstance(el).hide();
          });
        }
      });

      /* ----------------- Collapse handling ----------------- */
      document
        .querySelectorAll("[data-bs-toggle='collapse']")
        .forEach((btn) => {
          btn.addEventListener("click", function (e) {
            const targetId = this.dataset.bsTarget;
            const collapseTarget = document.querySelector(targetId);

            allMenus.forEach((id) => {
              if (id !== targetId) {
                bootstrap.Collapse.getOrCreateInstance(
                  document.querySelector(id)
                ).hide();
              }
            });

            if (sidebar.classList.contains("collapsed")) {
              e.preventDefault();
              sidebar.classList.remove("collapsed");
              sidebar.classList.add("expanded");
              localStorage.setItem("sidebar", "expanded");

              setTimeout(() => {
                bootstrap.Collapse.getOrCreateInstance(collapseTarget).show();
              }, 300);
            }
          });
        });

      /* ----------------- Tabs ----------------- */
      function showTab(index) {
        window.scrollTo({ top: 0, behavior: "smooth" });

        document.querySelectorAll(".tab").forEach((el, i) => {
          el.classList.toggle("active", i == index);
        });

        document.querySelectorAll(".nav-link[data-tab]").forEach((el) => {
          el.classList.toggle("active", el.dataset.tab == index);
        });
      }

      document.querySelectorAll(".nav-link[data-tab]").forEach((el) => {
        el.addEventListener("click", () => {
          const dataTab = el.getAttribute("data-tab"); // e.g. "0.#Dataset-overview"
          if (dataTab) {
            // Split at '.' to separate tab index and anchor (format: "tab.anchor")
            const [tabIndex, anchor] = dataTab.split('.');
            if (tabIndex) showTab(tabIndex);

            // Remove active from all buttons
            document.querySelectorAll(".nav-link[data-tab]").forEach((btn) => {
              btn.classList.remove("active");
            });

            // Add active only to the clicked button (exact data-tab match)
            document.querySelectorAll(".nav-link[data-tab]").forEach((btn) => {
              if (btn.getAttribute("data-tab") === dataTab) {
                btn.classList.add("active");
              }
            });

            if (anchor) {
              // Smooth scroll to element by id (remove # from anchor)
              const anchorId = anchor.startsWith('#') ? anchor.slice(1) : anchor;
              const targetElement = document.getElementById(anchorId);
              if (targetElement) {
                targetElement.scrollIntoView({ behavior: "smooth" });
                history.pushState(null, '', '#' + anchorId);
              } else {
                window.location.hash = anchor;
              }
            }
          }
        });
      });




      /* ----------------- Theme ----------------- */
      function applyTheme(theme) {
        html.setAttribute("data-bs-theme", theme);
        themeToggle.checked = theme === "dark";
        localStorage.setItem("theme", theme);
      }

      themeToggle.addEventListener("change", () => {
        applyTheme(themeToggle.checked ? "dark" : "light");
      });

      /* ----------------- Initial setup ----------------- */
      document.addEventListener("DOMContentLoaded", () => {
        // Theme
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme) {
          applyTheme(savedTheme);
        } else {
          const systemPref = window.matchMedia(
            "(prefers-color-scheme: dark)"
          ).matches
            ? "dark"
            : "light";
          applyTheme(systemPref);
        }

        // Sidebar state
        const savedSidebar = localStorage.getItem("sidebar");
        if (savedSidebar) {
          sidebar.classList.remove("collapsed", "expanded");
          sidebar.classList.add(savedSidebar);
        } else {
          sidebar.classList.add("expanded");
        }

        // Collapse menus start hidden
        allMenus.forEach((id) => {
          bootstrap.Collapse.getOrCreateInstance(document.querySelector(id), {
            toggle: false,
          }).hide();
        });
      });
    </script>
  </body>
</html>
