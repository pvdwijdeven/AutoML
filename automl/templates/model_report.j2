<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title }}</title>
    <script src="https://cdn.plot.ly/plotly-3.1.0-rc.0.min.js" charset="utf-8"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>

    html {
      scroll-behavior: smooth;
    }
    body { font-family: sans-serif;}
    .tab { display: none; }
    .tab.active { display: block; }

.highlight-yellow {
  /* Light mode highlight */
  color: #ff0800ff;  padding: 0.2em 0.4em;
  border-radius: 0.2em;
}

[data-bs-theme="dark"] .highlight-yellow {
  /* Dark mode highlight */
  color: #f10c0cff;
}

.inner-table-wrapper {
  overflow-x: auto;
  max-width: 100%;
}

.inner-table-wrapper table {
  width: max-content;
  min-width: 100%;
}

.inner-table-wrapper::-webkit-scrollbar {
  height: 6px;
}
.inner-table-wrapper::-webkit-scrollbar-thumb {
  background-color: #aaa;
  border-radius: 3px;
}

  .flex-grow-1 {
    min-width: 0;
    overflow-x: hidden;
  }
    .feature-select {
      position: fixed;
      top: 35px; 

      z-index: 999;
      padding: 5px 2em;

      font-size: 14px;
      font-weight: bold;
    }
    .feature-link {
      text-decoration: none;
    }

    .feature-link:hover {
      text-decoration: underline;
    }
  .table-wrapper {
    overflow-x: auto;
    width: 90%;
  }
  .table-wrapper table {
    width: max-content;
    min-width: 90%;
  }
  .table-wrapper th, .table-wrapper td {
    padding: 8px;
  }
  .table-wrapper {
    background-color: var(--bs-table-striped-bg);
  }

  .tabcontent-inner { display: none; padding: 10px 0; }
    .tab-inner button { 
      margin-right: 5px; 
      min-width: 120px;
      min-height: 20px;
      text-align: center;
      cursor: pointer;
    }
  
  .tabcontent-inner_test { display: none; padding: 10px 0; }
    .tab-inner_test button { 
      margin-right: 5px; 
      min-width: 120px;
      min-height: 20px;
      text-align: center;
      cursor: pointer;
    }

  table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1em;
  }
  th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
  }
  h2 {
      margin-top: 2em;
  }
  table td:first-child,
  table th:first-child {
    width: 200px; /* or any fixed pixel value */
    white-space: nowrap; /* optional: prevents text from wrapping */
  }
  .frequency-table {
    border-collapse: collapse;
    margin-top: 10px;
    width: 100%;
  }
  .frequency-table th, .frequency-table td {
    padding: 6px 12px;
    border: 1px solid #ccc;
    text-align: left;
  }

  .frequency-table td:first-child,
  .frequency-table th:first-child,
  .frequency-table td:nth-child(2),
  .frequency-table th:nth-child(2) {
    white-space: nowrap;
    width: 1%;
  }
  .frequency-table td:first-child {
    text-align: left;
  }
  table td, table th {
    vertical-align: top;
  }
.header-title-group {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  width: 100%;
}

  .plot-wrapper {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .plot-cell {
    flex: 1 1 300px;
    min-width: 250px;
    max-width: 100%;
  }

  .responsive-img {
    width: 100%;
    height: auto;
    display: block;
  }

.report-date {
  margin: 0;
  font-size: 0.9em;
  margin-left: auto;
  padding-right: 80px;
}

      body {
        overflow-x: hidden;
      }

    .sidebar {
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      transition: width 0.3s ease;
    }

.sidebar.collapsed {
  flex: 0 0 60px;
  width: 60px;
}
.sidebar.expanded {
  flex: 0 0 250px;
  width: 250px;
}

      #toggleSidebar {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.375rem 0.5rem;
        width: 40px;
        height: 40px;
      }

      .sidebar .nav-link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.375rem 1rem;
        white-space: nowrap;
      }

      .sidebar .nav-link i {
        flex-shrink: 0;
        width: 20px;
        text-align: center;
        line-height: 1;
        font-size: 1.25rem;
      }

      .menu-label {
        transition: opacity 0.3s, width 0.3s;
      }

      .sidebar.collapsed .menu-label {
        opacity: 0;
        width: 0;
        overflow: hidden;
      }

      .sidebar.collapsed ul.nav > li.nav-item {
        margin-bottom: 0;
      }

      .sidebar.collapsed ul.nav > li.nav-item > a.nav-link {
        padding-left: 0.5rem;
        padding-right: 0.5rem;
        justify-content: center;
      }

      .collapse-inner {
        padding-left: 1.5rem;
      }

      @media (max-width: 768px) {
        .sidebar {
          position: absolute;
          z-index: 1040;
        }
      }
    </style>
  </head>
  <body>
    <div class="d-flex">
      <!-- Sidebar -->
      <div id="sidebar" class="sidebar bg-body-tertiary expanded border-end">
        <div class="d-flex flex-column p-3">
          <button
            id="toggleSidebar"
            class="btn btn-outline-secondary mb-3"
            aria-label="Toggle sidebar"
          >
            <i class="bi bi-list"></i>
          </button>

          <ul class="nav nav-pills flex-column mb-auto" id="menuAccordion">
            <!-- General overview (no submenu)-->
            <li class="nav-item">
              <a class="nav-link" href="#" onclick="showTab('0')">
                <i class="bi bi-house"></i
                ><span class="menu-label">General</span>
              </a>
            </li>
            </li>

            <!-- Details (no submenu) -->
            <li class="nav-item">
              <a class="nav-link" href="#" onclick="showTab('1')">
                <i class="bi bi-ui-checks-grid"></i
                ><span class="menu-label">Details</span>
              </a>
            </li>
          </ul>

          <hr />
          <div class="d-flex justify-content-between">
            <span class="menu-label">Theme</span>
            <div class="form-check form-switch">
              <input
                class="form-check-input"
                type="checkbox"
                id="themeToggle"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="flex-grow-1 p-4">
        <div class="header-title-group">
          <h1>{{ title }}</h1>
          <p class="report-date">Report generated on: {{ current_time.strftime("%Y-%m-%d %H:%M:%S") }}</p>
        </div>
          {% for tab in tabs %}
            <div class="tab {% if loop.index0 == 0 %}active{% endif %}" id="tab-{{ loop.index0 }}">
              {{ tab.content | safe }}
            </div>
          {% endfor %}
      </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
      const sidebar = document.getElementById("sidebar");
      const toggleBtn = document.getElementById("toggleSidebar");
      const themeToggle = document.getElementById("themeToggle");
      const html = document.documentElement;

      const allMenus = Array.from(document.querySelectorAll('.collapse')).map(el => `#${el.id}`);

      window.addEventListener("DOMContentLoaded", () => {
        allMenus.forEach((id) => {
          const el = document.querySelector(id);
          const collapse = bootstrap.Collapse.getOrCreateInstance(el, {
            toggle: false,
          });
          collapse.hide();
        });
      });

      toggleBtn.addEventListener("click", () => {
        const isCollapsing = sidebar.classList.contains("expanded");
        sidebar.classList.toggle("collapsed");
        sidebar.classList.toggle("expanded");

        if (isCollapsing) {
          allMenus.forEach((id) => {
            const el = document.querySelector(id);
            const collapse = bootstrap.Collapse.getOrCreateInstance(el);
            collapse.hide();
          });
        }
      });

      document
        .querySelectorAll('[data-bs-toggle="collapse"]')
        .forEach((link) => {
          link.addEventListener("click", function (e) {
            const targetId = this.getAttribute("href") || this.dataset.target;
            const collapseTarget = document.querySelector(targetId);

            allMenus.forEach((id) => {
              if (id !== targetId) {
                const otherCollapse = bootstrap.Collapse.getOrCreateInstance(
                  document.querySelector(id)
                );
                otherCollapse.hide();
              }
            });

            if (sidebar.classList.contains("collapsed")) {
              e.preventDefault();
              sidebar.classList.remove("collapsed");
              sidebar.classList.add("expanded");

              setTimeout(() => {
                const bsCollapse =
                  bootstrap.Collapse.getOrCreateInstance(collapseTarget);
                bsCollapse.show();
              }, 300);
            }
          });
        });

      const systemPref = window.matchMedia("(prefers-color-scheme: dark)")
        .matches
        ? "dark"
        : "light";
      html.setAttribute("data-bs-theme", systemPref);
      themeToggle.checked = systemPref === "dark";

        function showTab(index) {
      // Remove active class from all tabs and buttons
      window.scrollTo({ top: 0, behavior: 'smooth' });
      document.querySelectorAll('.tab').forEach((el, i) => {
        el.classList.toggle('active', i == index);
      });
    }


    themeToggle.addEventListener("change", () => {
        html.setAttribute(
          "data-bs-theme",
          themeToggle.checked ? "dark" : "light"
        );
      });
    </script>

  </body>
</html>
